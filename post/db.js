// Generated by CoffeeScript 1.6.2
(function() {
  var ObjectId, Schema, articleBodies, articles, issues, mongoose, monguurl, sections;

  mongoose = require('mongoose');

  monguurl = require('monguurl');

  Schema = mongoose.Schema;

  ObjectId = Schema.ObjectId;

  mongoose.connect('localhost', 'torch');

  articles = new Schema({
    title: {
      type: String,
      required: true
    },
    slug: {
      type: String,
      index: {
        unique: true
      }
    },
    author: {
      type: String,
      required: true
    },
    lockHTML: {
      type: Boolean,
      "default": false
    },
    body: [articleBodies],
    publishDate: {
      type: Date,
      "default": null
    },
    createdDate: {
      type: Date,
      "default": Date.now
    },
    status: {
      type: Number,
      "default": 0
    },
    approvedBy: {
      advisor: {
        type: Number,
        "default": 0
      },
      administration: {
        type: Number,
        "default": 0
      }
    },
    staffComments: [
      {
        body: {
          rendered: {
            type: String,
            required: true
          },
          notRendered: {
            type: String,
            required: true
          }
        },
        author: {
          type: String,
          required: true
        },
        edited: {
          type: Boolean,
          "default": false
        },
        createdDate: {
          type: Date,
          "default": Date.now
        }
      }
    ],
    views: {
      type: Number,
      "default": 0
    },
    publication: {
      type: Number,
      "default": 0
    }
  });

  articleBodies = new Schema({
    body: {
      type: String,
      required: true
    },
    editor: {
      type: String,
      required: true
    },
    editDate: {
      type: Date,
      "default": Date.now
    }
  });

  articles.plugin(monguurl({
    source: 'title',
    target: 'slug'
  }));

  issues = new Schema({
    title: {
      type: String,
      required: true
    },
    slug: {
      type: String,
      index: {
        unique: true
      }
    },
    publication: {
      type: Number,
      "default": 0,
      required: true
    },
    publishDate: {
      type: Date,
      required: true
    },
    createdDate: {
      type: Date,
      "default": Date.now,
      required: true
    }
  });

  issues.plugin(monguurl({
    source: 'title',
    target: 'slug'
  }));

  sections = new Schema({
    title: {
      type: String,
      required: true
    },
    slug: {
      type: String,
      index: {
        unique: true
      }
    }
  });

  sections.plugin(monguurl({
    source: 'title',
    target: 'slug'
  }));

  ({
    type: String
  });

  module.exports = {
    ObjectId: ObjectId,
    Articles: mongoose.model('articles', articles),
    Issues: mongoose.model('issues', issues),
    Sections: mongoose.model('sections', sections)
  };

}).call(this);
