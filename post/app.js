// Generated by CoffeeScript 1.6.2
(function() {
  var app, articles, cluster, cpu, cpus, express, http, issues, path, photos, sections, users, _i;

  cluster = require('cluster');

  if (cluster.isMaster) {
    cpus = require('os').cpus().length;
    for (cpu = _i = 0; 0 <= cpus ? _i < cpus : _i > cpus; cpu = 0 <= cpus ? ++_i : --_i) {
      cluster.fork();
    }
    cluster.on('exit', function(worker) {
      console.log("Worker " + worker.id + " died :(");
      return cluster.fork();
    });
  } else {
    express = require('express');
    http = require('http');
    path = require('path');
    articles = require('./routes/articles');
    issues = require('./routes/issues');
    sections = require('./routes/sections');
    users = require('./routes/users');
    photos = require('./routes/photos');
    app = express();
    app.configure(function() {
      app.use(express.cookieParser('***REMOVED***'));
      app.use(express["static"](path.join(__dirname, 'public')));
      app.use(express.session({
        cookie: {
          maxAge: 15552000000
        }
      }));
      app.use(express.bodyParser());
      app.set('views', __dirname + '/views');
      app.set('view engine', 'jade');
      app.disable('x-powered-by');
      app.set('port', process.env.PORT || 8000);
      return true;
    });
    /*
    	Update this stuff
    */

    app.get('/', articles.index);
    app.get('/articles/:slug', articles.view);
    /*
    	/Update this stuff
    */

    /*
    	Staff Stuff
    */

    app.get('/staff/articles/new', articles.new_get);
    app.post('/staff/articles/new', articles.new_post);
    app.get('/staff/articles/:slug', articles.view);
    app.post('/staff/articles/:slug/comment', articles.comment);
    app.get('/staff/articles/:slug/edit', articles.edit_get);
    app.post('/staff/articles/:slug/edit', articles.edit_post);
    app.post('/staff/articles/:slug/delete', articles.remove);
    app.get('/staff/articles/:slug/photos/upload', photos.view);
    app.get("/staff/articles/:slug/photos/upload/signS3/:mime(\\w+\/\\w+)", photos.auth);
    app.get("/staff/articles/:slug/photos/upload/confirmed/:id(\\d+)", photos.addToDB);
    app.get('/staff/issues', issues.list);
    app.get('/staff/issues/new', issues.new_get);
    app.post('/staff/issues/new', issues.new_post);
    app.get('/staff/issues/:slug', issues.edit_get);
    app.post('/staff/issues/:slug', issues.edit_post);
    app.get('/staff/sections', sections.list);
    app.get('/staff/sections/new', sections.new_get);
    app.post('/staff/sections/new', sections.new_post);
    app.get('/staff/sections/:slug', sections.edit_get);
    app.post('/staff/sections/:slug', sections.edit_post);
    app.get('/staff/users', users.list);
    app.get('/staff/users/new', users.new_get);
    app.post('/staff/users/new', users.new_post);
    app.get('/staff/users/:slug', users.edit_get);
    app.post('/staff/users/:slug', users.edit_post);
    app.post('/staff/users/:slug/delete', users.remove);
    /*
    	End Staff Suff
    */

    app.listen(app.get('port'), function() {
      console.log("Express server listening on port " + app.get('port'));
      return console.log("Worker " + cluster.worker.id + " running!");
    });
  }

}).call(this);
